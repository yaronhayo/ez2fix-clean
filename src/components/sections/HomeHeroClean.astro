---
import { siteConfig } from '@/config/site';
import BookingFormClean from '@/components/ui/BookingFormClean.astro';
import Card from '@/components/ui/Card.astro';
import CTA from '@/components/ui/CTA.astro';
---

<section class="relative py-8 lg:py-12 overflow-hidden hero-section">
  <!-- Optimized static background for LCP - video loads after interaction -->
  <div class="absolute inset-0 w-full h-full hero-background"></div>

  <!-- Video loads immediately for visual impact -->
  <video
    muted
    loop
    playsinline
    autoplay
    preload="metadata"
    class="absolute inset-0 w-full h-full object-cover hero-video opacity-0 transition-opacity duration-1000"
    id="heroVideo"
  >
    <source src="https://qjvikxuhqs1py0go.public.blob.vercel-storage.com/ez2fix-hero-background.mp4" type="video/mp4">
  </video>

  <!-- Immediate background for LCP -->
  <div class="absolute inset-0 w-full h-full bg-gradient-to-br from-gray-900 via-gray-800 to-black"></div>

  <!-- Overlay with clean gradient -->
  <div class="absolute inset-0 bg-gradient-to-br from-black/85 via-black/70 to-black/85"></div>

  <div class="container mx-auto px-4 relative z-10">
    <div class="max-w-7xl mx-auto">

      <!-- Hero Content Grid -->
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 lg:gap-8 items-start lg:items-center">

        <!-- Left Side - Hero Content -->
        <div class="order-2 lg:order-1 pt-4 lg:pt-0">

          <!-- SEO-Optimized Main Headlines -->
          <h1 class="text-3xl sm:text-4xl md:text-5xl lg:text-6xl xl:text-7xl font-bold text-white mb-4 lg:mb-5 leading-tight">
            <span class="text-white">Professional</span> <span class="text-ez2fix-gold">Garage Door Repair</span>
            <br />
            <span class="text-white">&</span> <span class="text-ez2fix-primary">Installation Services</span>
            <br />
            <span class="text-ez2fix-gold">in New Jersey</span>
          </h1>

          <!-- SEO-Optimized Subtitle with Keywords -->
          <p class="text-lg sm:text-xl lg:text-2xl text-white mb-4 lg:mb-5 leading-relaxed">
            Professional <span class="text-ez2fix-gold font-semibold">garage door repair near me</span> and <span class="text-ez2fix-gold font-semibold">garage door installation</span> across 5 New Jersey counties.
          </p>

          <!-- Service Coverage -->
          <div class="text-center lg:text-left mb-5 lg:mb-6">
            <p class="text-sm sm:text-base text-ez2fix-gold mb-1.5">Serving Bergen • Essex • Morris • Hudson • Passaic Counties</p>
            <p class="text-xs sm:text-sm text-ez2fix-primary">Licensed Contractor #13VH13553300 • 12,000+ Families Served</p>
          </div>


          <!-- CTAs -->
          <div class="flex flex-col sm:flex-row gap-3 mb-6 lg:mb-0">
            <a
              href={siteConfig.links.phone}
              class="px-8 py-4 lg:px-10 lg:py-4 bg-ez2fix-primary hover:bg-ez2fix-primary/90 text-ez2fix-dark font-bold text-base lg:text-lg rounded-xl shadow-lg hover:shadow-xl transition-all duration-300 flex items-center justify-center gap-2"
            >
              <svg class="w-5 h-5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"/>
              </svg>
              <span>Call {siteConfig.business.phone}</span>
            </a>
            <a
              href="/services"
              class="px-8 py-4 lg:px-10 lg:py-4 border-2 border-ez2fix-gold hover:bg-ez2fix-gold text-ez2fix-gold hover:text-ez2fix-dark font-bold text-base lg:text-lg rounded-xl transition-all duration-300 flex items-center justify-center gap-2"
            >
              <span>View Services</span>
              <svg class="w-5 h-5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
              </svg>
            </a>
          </div>

        </div>

        <!-- Right Side - Booking Form (Desktop) -->
        <div class="order-1 lg:order-2 hidden lg:block">
          <Card class="p-5 shadow-xl border-2 bg-ez2fix-cream border-ez2fix-primary max-w-md mx-auto">
            <BookingFormClean variant="hero" />

            <!-- Form Benefits -->
            <div class="mt-3 pt-3 border-t border-ez2fix-brown/20">
              <div class="grid grid-cols-2 gap-2 text-center">
                <div>
                  <div class="text-base font-bold text-ez2fix-dark">Same Day Fix</div>
                  <div class="text-xs text-ez2fix-brown">Professional Service</div>
                </div>
                <div>
                  <div class="text-base font-bold text-ez2fix-dark">Honest Pricing</div>
                  <div class="text-xs text-ez2fix-brown">Price Before Work</div>
                </div>
              </div>
            </div>
          </Card>
        </div>
      </div>

    </div>
  </div>
</section>

<script>
  // Start video immediately when page loads
  document.addEventListener('DOMContentLoaded', function() {
    const video = document.getElementById('heroVideo');
    if (!video) return;

    // Check for user preferences
    const prefersReducedMotion = window.matchMedia('(prefers-reduced-motion: reduce)').matches;
    const connection = navigator.connection || navigator.mozConnection || navigator.webkitConnection;
    const isSlowConnection = connection && (connection.effectiveType === 'slow-2g' || connection.effectiveType === '2g');

    if (prefersReducedMotion || isSlowConnection) {
      // Hide video and show static background for accessibility/slow connections
      video.style.display = 'none';
      return;
    }

    // Start video immediately
    video.addEventListener('loadeddata', () => {
      video.play().then(() => {
        // Smooth fade-in once video starts playing
        video.classList.remove('opacity-0');
        video.classList.add('opacity-100');
      }).catch((error) => {
        // Video autoplay blocked or failed, keep static background
        console.log('Video autoplay prevented:', error.message);
        video.style.display = 'none';
      });
    }, { once: true });

    // Fallback in case video has issues
    video.addEventListener('error', () => {
      video.style.display = 'none';
    });
  });
</script>

<style>
  .hero-section {
    min-height: auto;
  }

  @media (min-width: 1024px) {
    .hero-section {
      min-height: calc(100vh - 80px);
      min-height: calc(100dvh - 80px);
      max-height: 900px;
      display: flex;
      align-items: center;
    }
  }

  .hero-background {
    background: linear-gradient(135deg, rgba(29, 25, 18, 0.95) 0%, rgba(42, 36, 32, 0.9) 100%),
                url('/images/ez2fix-garage-door-repair.jpg') center/cover no-repeat;
  }

  @media (prefers-reduced-motion: reduce) {
    .hero-video {
      display: none;
    }
  }
</style>

