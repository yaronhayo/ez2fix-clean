---
export interface Props {
  pageType?: 'homepage' | 'about' | 'contact' | 'services';
}

const { pageType = 'homepage' } = Astro.props;

const reviews = [
  {
    name: "Maria Rodriguez",
    location: "Elmwood Park, NJ",
    text: "Called Ez2Fix when my garage door spring broke. Professional from start to finish. The technician explained everything and completed the repair beautifully.",
    service: "Spring Replacement"
  },
  {
    name: "David Chen", 
    location: "Jersey City, NJ",
    text: "Excellent customer service! Quick response, convenient scheduling, and professional work. Highly recommend their services.",
    service: "Door Installation"
  },
  {
    name: "Susan Thompson",
    location: "Fair Lawn, NJ", 
    text: "Ez2Fix made the whole process easy. From the phone call to completion, everything went smoothly. Very satisfied with their professional service.",
    service: "Opener Repair"
  },
  {
    name: "Michael Johnson",
    location: "Garfield, NJ",
    text: "Great experience working with Ez2Fix. Honest about what needed fixing and provided excellent service. The garage door works perfectly now.",
    service: "Track Repair"
  },
  {
    name: "Jennifer Walsh",
    location: "Hoboken, NJ",
    text: "Professional service from start to finish. Arrived on time, diagnosed quickly, and fixed my garage door opener perfectly. Will call them again.",
    service: "Opener Service"
  },
  {
    name: "Robert Kim",
    location: "Wood-Ridge, NJ",
    text: "Outstanding service! My garage door was making terrible noises. Ez2Fix fixed it professionally and it's been working perfectly ever since.",
    service: "Maintenance"
  }
];
---

<div class="reviews-carousel relative">
  <!-- Reviews Container -->
  <div class="reviews-track flex transition-transform duration-700 ease-in-out">
    {reviews.map((review, index) => (
      <div class="review-slide min-w-full sm:min-w-1/2 lg:min-w-1/3 px-2 sm:px-3" data-index={index}>
        <div class="p-4 sm:p-5 md:p-6 rounded-xl shadow-xl hover:shadow-2xl transition-all duration-300 border-2 mx-auto max-w-sm bg-ez2fix-cream border-ez2fix-gold">
          
          <!-- Stars -->
          <div class="flex justify-center mb-4 sm:mb-6">
            {[1,2,3,4,5].map(() => (
              <svg class="h-5 w-5 sm:h-6 sm:w-6 text-ez2fix-primary" fill="currentColor" viewBox="0 0 24 24">
                <path d="M12 .587l3.668 7.431 8.332 1.151-6.064 5.828 1.48 8.279-7.416-3.967-7.417 3.967 1.481-8.279-6.064-5.828 8.332-1.151z"/>
              </svg>
            ))}
          </div>
          
          <!-- Quote -->
          <blockquote class="text-base sm:text-lg leading-relaxed mb-4 sm:mb-6 text-center italic text-ez2fix-dark">
            "{review.text}"
          </blockquote>
          
          <!-- Customer Info -->
          <div class="flex flex-col sm:flex-row items-center justify-center space-y-2 sm:space-y-0 sm:space-x-4">
            <!-- Avatar -->
            <div class="w-10 h-10 sm:w-12 sm:h-12 rounded-full flex items-center justify-center font-bold text-base sm:text-lg bg-ez2fix-primary text-ez2fix-cream">
              {review.name.split(' ').map(n => n[0]).join('')}
            </div>
            
            <div class="text-center">
              <div class="font-semibold text-base sm:text-lg text-ez2fix-dark">{review.name}</div>
              <div class="text-xs sm:text-sm text-ez2fix-brown">{review.location}</div>
              <div class="text-xs font-medium px-2 py-1 rounded-full mt-1 bg-ez2fix-gold text-ez2fix-dark">
                {review.service}
              </div>
            </div>
          </div>
        </div>
      </div>
    ))}
  </div>
  
  <!-- Navigation Dots -->
  <div class="flex justify-center space-x-2 mt-8">
    {reviews.map((_, index) => (
      <button 
        class="carousel-dot w-3 h-3 rounded-full transition-transform duration-300 bg-ez2fix-brown hover:bg-ez2fix-primary"
        data-index={index}
        aria-label={`Go to review ${index + 1}`}
      ></button>
    ))}
  </div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    const carousel = document.querySelector('.reviews-carousel');
    if (!carousel) return;
    
    const track = carousel.querySelector('.reviews-track');
    const slides = carousel.querySelectorAll('.review-slide');
    const dots = carousel.querySelectorAll('.carousel-dot');
    
    let currentIndex = 0;
    let autoplayInterval;
    let slidesPerView = 1;
    
    // Calculate slides per view
    function calculateSlidesPerView() {
      const width = window.innerWidth;
      slidesPerView = width >= 1024 ? 3 : width >= 640 ? 2 : 1;
    }
    
    // Update carousel position
    function updateCarousel() {
      calculateSlidesPerView();
      const slideWidth = 100 / slidesPerView;
      const translateX = -currentIndex * slideWidth;
      track.style.transform = `translateX(${translateX}%)`;
      
      // Update dots using CSS classes for GPU compositing
      dots.forEach((dot, index) => {
        dot.classList.toggle('active', index === currentIndex);
      });
    }
    
    // Next slide
    function nextSlide() {
      const maxIndex = slides.length - slidesPerView;
      currentIndex = currentIndex >= maxIndex ? 0 : currentIndex + 1;
      updateCarousel();
    }
    
    // Go to specific slide
    function goToSlide(index) {
      currentIndex = index;
      updateCarousel();
    }
    
    // Autoplay
    function startAutoplay() {
      autoplayInterval = setInterval(nextSlide, 3000);
    }
    
    function stopAutoplay() {
      clearInterval(autoplayInterval);
    }
    
    // Dot click handlers
    dots.forEach((dot, index) => {
      dot.addEventListener('click', () => {
        goToSlide(index);
        stopAutoplay();
        startAutoplay();
      });
    });
    
    // Pause on hover
    carousel.addEventListener('mouseenter', stopAutoplay);
    carousel.addEventListener('mouseleave', startAutoplay);
    
    // Handle resize
    window.addEventListener('resize', updateCarousel);
    
    // Initialize
    updateCarousel();
    startAutoplay();
  });
</script>

<style>
  .review-slide {
    flex-shrink: 0;
  }
  
  @media (min-width: 640px) {
    .review-slide {
      min-width: 50%;
    }
  }
  
  @media (min-width: 1024px) {
    .review-slide {
      min-width: 33.333333%;
    }
  }
  
  .reviews-track {
    transition: transform 0.7s ease-in-out;
    will-change: transform;
  }
  
  /* GPU-composited carousel dot animations */
  .carousel-dot {
    will-change: transform, background-color;
    transform: translateZ(0); /* Force GPU acceleration */
    transition: transform 0.3s ease, background-color 0.3s ease;
  }
  
  .carousel-dot:hover {
    transform: translateZ(0) scale(1.1);
  }
  
  .carousel-dot.active {
    transform: translateZ(0) scale(1.2);
    background-color: var(--ez2fix-primary);
  }
  
  .carousel-dot:not(.active) {
    transform: translateZ(0) scale(1);
    background-color: var(--ez2fix-brown);
  }
</style>