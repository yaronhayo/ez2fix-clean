---
import { siteConfig } from '@/config/site';
import CTA from '@/components/ui/CTA.astro';

const services = [
  { name: '24/7 Emergency Repair', href: '/services/emergency-garage-door-repair' },
  { name: 'Spring Repair', href: '/services/garage-door-spring-repair' },
  { name: 'Opener Installation', href: '/services/garage-door-opener-installation' },
  { name: 'New Door Installation', href: '/services/new-garage-door-installation' },
  { name: 'Commercial Service', href: '/services/commercial-garage-door-service' },
  { name: 'General Repair', href: '/services/general-garage-door-repair' }
];

const serviceAreas = [
  { name: 'North Caldwell', href: '/service-areas/north-caldwell' },
  { name: 'West Caldwell', href: '/service-areas/west-caldwell' },
  { name: 'Little Falls', href: '/service-areas/little-falls' },
  { name: 'Montclair', href: '/service-areas/montclair' },
  { name: 'Cedar Grove', href: '/service-areas/cedar-grove' },
  { name: 'Fair Lawn', href: '/service-areas/fair-lawn' },
  { name: 'Clifton', href: '/service-areas/clifton' }
];
---

<header class="sticky top-0 z-50 w-full border-b bg-white/95 backdrop-blur supports-[backdrop-filter]:bg-white/90">
  <div class="container flex h-16 sm:h-20 items-center justify-between">
    <!-- Logo -->
    <div class="flex items-center">
      <a href="/" class="flex items-center">
        <img 
          src={siteConfig.logo}
          alt="Ez2Fix - Professional Garage Door Services" 
          width="200"
          height="80"
          loading="eager"
          decoding="sync"
          class="h-12 sm:h-16 lg:h-20 w-auto"
        />
      </a>
    </div>

    <!-- Desktop Navigation -->
    <nav class="hidden md:flex items-center space-x-4 md:space-x-6 lg:space-x-8">
      <!-- Services Dropdown -->
      <div class="relative group">
        <button 
          class="text-sm font-semibold text-ez2fix-dark hover:text-ez2fix-primary transition-colors flex items-center space-x-1 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 rounded px-2 py-1" 
          aria-expanded="false"
          aria-haspopup="true"
        >
          <span>Services</span>
          <svg class="h-4 w-4 transition-transform group-hover:rotate-180" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
          </svg>
        </button>
        
        <!-- Dropdown Menu -->
        <div class="absolute top-full left-0 mt-2 w-72 md:w-80 opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-300 transform translate-y-2 group-hover:translate-y-0 z-50">
          <div class="bg-ez2fix-cream border-2 border-ez2fix-primary rounded-lg shadow-xl py-2">
            {services.map(service => (
              <a href={service.href} class="dropdown-item">
                <div class="flex items-center space-x-3">
                  <div class="w-2 h-2 rounded-full bg-ez2fix-primary"></div>
                  <span>{service.name}</span>
                </div>
              </a>
            ))}
            
            <div class="border-t my-2 border-ez2fix-brown/20"></div>
            
            <a href="/services" class="dropdown-item font-semibold text-ez2fix-primary">
              <div class="flex items-center space-x-3">
                <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
                </svg>
                <span>View All Services</span>
              </div>
            </a>
          </div>
        </div>
      </div>
      
      <!-- Service Areas Dropdown -->
      <div class="relative group">
        <button class="text-sm font-semibold text-ez2fix-dark hover:text-ez2fix-primary transition-colors flex items-center space-x-1">
          <span>Service Areas</span>
          <svg class="h-4 w-4 transition-transform group-hover:rotate-180" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
          </svg>
        </button>
        
        <div class="absolute top-full left-0 mt-2 w-64 opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-300 transform translate-y-2 group-hover:translate-y-0 z-50">
          <div class="bg-ez2fix-cream border-2 border-ez2fix-primary rounded-lg shadow-xl py-2">
            {serviceAreas.map(area => (
              <a href={area.href} class="dropdown-item">
                <div class="flex items-center space-x-3">
                  <div class="w-2 h-2 rounded-full bg-ez2fix-gold"></div>
                  <span>{area.name}</span>
                </div>
              </a>
            ))}
            
            <div class="border-t my-2 border-ez2fix-brown/20"></div>
            
            <a href="/service-areas" class="dropdown-item font-semibold text-ez2fix-primary">
              <div class="flex items-center space-x-3">
                <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
                </svg>
                <span>View All Service Areas</span>
              </div>
            </a>
          </div>
        </div>
      </div>

      <a href="/faq" class="text-sm font-semibold text-ez2fix-dark hover:text-ez2fix-primary transition-colors">FAQ</a>
      <a href="/reviews" class="text-sm font-semibold text-ez2fix-dark hover:text-ez2fix-primary transition-colors">Reviews</a>
      <a href="/about" class="text-sm font-semibold text-ez2fix-dark hover:text-ez2fix-primary transition-colors">About</a>
      <a href="/contact" class="text-sm font-semibold text-ez2fix-dark hover:text-ez2fix-primary transition-colors">Contact</a>
    </nav>

    <!-- Desktop CTA Buttons -->
    <div class="hidden md:flex items-center space-x-3">
      <!-- Phone CTA -->
      <CTA 
        variant="phone" 
        size="small" 
        href={siteConfig.links.phone} 
        text={`Call ${siteConfig.business.phone}`}
        icon="phone"
        class="hidden md:inline-flex"
        ariaLabel={`Call Ez2Fix at ${siteConfig.business.phone}`}
      />
      
      <!-- Book Service CTA -->
      <CTA 
        variant="primary" 
        size="small" 
        href="/booking" 
        text="Book Service"
        icon="calendar"
        class="hidden lg:inline-flex"
        ariaLabel="Book garage door service online"
      />
    </div>

    <!-- Mobile CTA & Menu -->
    <div class="md:hidden flex items-center space-x-2">
      <!-- Mobile Phone CTA -->
      <CTA 
        variant="phone" 
        size="small" 
        href={siteConfig.links.phone} 
        text="Call"
        icon="phone"
        class="sm:hidden"
        ariaLabel={`Call Ez2Fix at ${siteConfig.business.phone}`}
      />
      
      <!-- Mobile Phone CTA with number (small screens and up) -->
      <CTA 
        variant="phone" 
        size="small" 
        href={siteConfig.links.phone} 
        text={siteConfig.business.phone}
        icon="phone"
        class="hidden sm:inline-flex md:hidden"
        ariaLabel={`Call Ez2Fix at ${siteConfig.business.phone}`}
      />
      
      <!-- Mobile Book CTA -->
      <CTA 
        variant="primary" 
        size="small" 
        href="/booking" 
        text="Book"
        icon="calendar"
        class=""
        ariaLabel="Book garage door service online"
      />
      
      <!-- Mobile Menu Button -->
      <button 
        id="mobile-menu-button" 
        class="p-2 rounded-lg transition-all duration-300 hover:shadow-md bg-ez2fix-primary/10 text-ez2fix-dark min-h-[44px] min-w-[44px] flex items-center justify-center"
        aria-expanded="false" 
        aria-haspopup="true" 
        aria-label="Open navigation menu"
      >
        <svg id="menu-open" class="h-6 w-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/>
        </svg>
        <svg id="menu-close" class="h-6 w-6 hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
        </svg>
      </button>
    </div>
  </div>
  
  <!-- Mobile Navigation Menu -->
  <div 
    id="mobile-menu" 
    class="md:hidden fixed top-16 sm:top-20 left-0 w-full max-h-[calc(100vh-4rem)] sm:max-h-[calc(100vh-5rem)] z-[60] transform translate-x-full transition-transform duration-300 ease-in-out bg-ez2fix-cream shadow-lg"
  >
    <div class="h-full overflow-y-auto flex flex-col">
      <nav class="px-6 py-4 space-y-3 flex-1">
        <!-- Services -->
        <div>
          <button 
            id="mobile-services-toggle"
            class="w-full text-lg font-semibold py-3 px-4 rounded-lg transition-all duration-300 hover:shadow-md flex items-center justify-between text-ez2fix-dark bg-ez2fix-brown/10"
          >
            <div class="flex items-center space-x-3">
              <svg class="h-5 w-5 text-ez2fix-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5m3 0h4"/>
              </svg>
              <span>Services</span>
            </div>
            <svg id="mobile-services-arrow" class="h-5 w-5 transition-transform text-ez2fix-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
            </svg>
          </button>
          
          <div id="mobile-services-submenu" class="hidden mt-2 pl-4 space-y-2">
            {services.map(service => (
              <a href={service.href} class="block py-2 px-4 text-sm font-medium rounded-lg transition-colors hover:shadow-md text-ez2fix-dark bg-ez2fix-gold/10">
                <div class="flex items-center space-x-3">
                  <div class="w-2 h-2 rounded-full bg-ez2fix-primary"></div>
                  <span>{service.name}</span>
                </div>
              </a>
            ))}
            
            <div class="border-t my-2 border-ez2fix-brown/20"></div>
            <a href="/services" class="block py-2 px-4 text-sm font-semibold rounded-lg transition-colors hover:shadow-md text-ez2fix-primary bg-ez2fix-primary/10">
              <div class="flex items-center space-x-3">
                <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
                </svg>
                <span>View All Services</span>
              </div>
            </a>
          </div>
        </div>

        <!-- Service Areas -->
        <div>
          <button 
            id="mobile-areas-toggle"
            class="w-full text-lg font-semibold py-3 px-4 rounded-lg transition-all duration-300 hover:shadow-md flex items-center justify-between text-ez2fix-dark bg-ez2fix-brown/10"
          >
            <div class="flex items-center space-x-3">
              <svg class="h-5 w-5 text-ez2fix-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"/>
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"/>
              </svg>
              <span>Service Areas</span>
            </div>
            <svg id="mobile-areas-arrow" class="h-5 w-5 transition-transform text-ez2fix-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
            </svg>
          </button>
          
          <div id="mobile-areas-submenu" class="hidden mt-2 pl-4 space-y-2">
            {serviceAreas.map(area => (
              <a href={area.href} class="block py-2 px-4 text-sm font-medium rounded-lg transition-colors hover:shadow-md text-ez2fix-dark bg-ez2fix-gold/10">
                <div class="flex items-center space-x-3">
                  <div class="w-2 h-2 rounded-full bg-ez2fix-gold"></div>
                  <span>{area.name}</span>
                </div>
              </a>
            ))}
            
            <div class="border-t my-2 border-ez2fix-brown/20"></div>
            <a href="/service-areas" class="block py-2 px-4 text-sm font-semibold rounded-lg transition-colors hover:shadow-md text-ez2fix-primary bg-ez2fix-primary/10">
              <div class="flex items-center space-x-3">
                <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
                </svg>
                <span>View All Service Areas</span>
              </div>
            </a>
          </div>
        </div>

        {[
          { name: 'FAQ', icon: 'M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z' },
          { name: 'Reviews', icon: 'M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z' },
          { name: 'About', icon: 'M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z' },
          { name: 'Contact', icon: 'M3 8l7.89 4.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z' }
        ].map(item => (
          <a 
            href={`/${item.name.toLowerCase()}`}
            class="block text-lg font-semibold py-3 px-4 rounded-lg transition-all duration-300 hover:shadow-md text-ez2fix-dark bg-ez2fix-brown/10"
          >
            <div class="flex items-center space-x-3">
              <svg class="h-5 w-5 text-ez2fix-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d={item.icon}/>
              </svg>
              <span>{item.name}</span>
            </div>
          </a>
        ))}
      </nav>
      
      <!-- Mobile CTA Section at Bottom -->
      <div class="px-6 py-3 border-t border-ez2fix-brown/20 bg-ez2fix-primary/5 mt-auto">
        <div class="grid grid-cols-1 gap-3">
          <CTA 
            variant="phone" 
            size="medium" 
            href={siteConfig.links.phone} 
            text={`Call ${siteConfig.business.phone}`}
            icon="phone"
            class="w-full justify-center min-h-[44px]"
            ariaLabel={`Call Ez2Fix at ${siteConfig.business.phone}`}
          />
          <CTA 
            variant="primary" 
            size="medium" 
            href="/booking" 
            text="Book Service Online"
            icon="calendar"
            class="w-full justify-center min-h-[44px]"
            ariaLabel="Book garage door service online"
          />
        </div>
      </div>
    </div>
  </div>
</header>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    const mobileMenuButton = document.getElementById('mobile-menu-button');
    const mobileMenu = document.getElementById('mobile-menu');
    const menuOpen = document.getElementById('menu-open');
    const menuClose = document.getElementById('menu-close');
    
    // Mobile menu toggle
    mobileMenuButton?.addEventListener('click', function() {
      const isOpen = mobileMenu?.classList.contains('translate-x-0');
      
      if (isOpen) {
        mobileMenu?.classList.remove('translate-x-0');
        mobileMenu?.classList.add('translate-x-full');
        menuOpen?.classList.remove('hidden');
        menuClose?.classList.add('hidden');
        this.setAttribute('aria-expanded', 'false');
      } else {
        mobileMenu?.classList.remove('translate-x-full');
        mobileMenu?.classList.add('translate-x-0');
        menuOpen?.classList.add('hidden');
        menuClose?.classList.remove('hidden');
        this.setAttribute('aria-expanded', 'true');
      }
    });
    
    // Mobile submenu toggles
    ['services', 'areas'].forEach(type => {
      const toggle = document.getElementById(`mobile-${type}-toggle`);
      const submenu = document.getElementById(`mobile-${type}-submenu`);
      const arrow = document.getElementById(`mobile-${type}-arrow`);
      
      toggle?.addEventListener('click', function() {
        const isOpen = !submenu?.classList.contains('hidden');
        
        if (isOpen) {
          submenu?.classList.add('hidden');
          arrow?.classList.remove('rotate-180');
        } else {
          submenu?.classList.remove('hidden');
          arrow?.classList.add('rotate-180');
        }
      });
    });
    
    // Close mobile menu when clicking outside
    document.addEventListener('click', function(e) {
      if (!mobileMenu?.contains(e.target) && !mobileMenuButton?.contains(e.target)) {
        mobileMenu?.classList.remove('translate-x-0');
        mobileMenu?.classList.add('translate-x-full');
        menuOpen?.classList.remove('hidden');
        menuClose?.classList.add('hidden');
        mobileMenuButton?.setAttribute('aria-expanded', 'false');
      }
    });
  });
</script>