---
import { siteConfig } from '@/config/site';
import { clientEnv } from '@/config/env';
import ScrollToTop from '@/components/ui/ScrollToTop.astro';
import '@/styles/globals.css';

export interface Props {
  title?: string;
  description?: string;
  ogImage?: string;
  canonicalURL?: URL;
  keywords?: string;
  robotsContent?: string;
}

const {
  title = siteConfig.title,
  description = siteConfig.description,
  ogImage = siteConfig.ogImage,
  canonicalURL = new URL(Astro.url.pathname, Astro.site),
  keywords = "garage door repair, garage door installation, Bergen County, Hudson County, NJ, emergency repair, licensed contractor",
  robotsContent = "index, follow, max-image-preview:large, max-snippet:-1, max-video-preview:-1"
} = Astro.props;

const fullTitle = title === siteConfig.title ? title : `${title} | ${siteConfig.name}`;
---

<!doctype html>
<html lang="en">
  <head>
    <!-- Ultra-Aggressive JavaScript Optimization -->
    <script is:inline>
    // Initialize critical globals
    window.dataLayer = window.dataLayer || [];
    window.ezPerformanceMode = true;
    
    // Enhanced idle scheduler with better task management
    class IdleScheduler {
      constructor() {
        this.tasks = [];
        this.isScheduled = false;
        this.longTaskThreshold = 16; // Keep tasks under 16ms
        this.maxTasksPerBatch = 3;
      }
      
      schedule(task, priority = 'low', delay = 0) {
        const taskData = { 
          task, 
          priority, 
          scheduled: Date.now(),
          delay,
          id: Math.random().toString(36).substr(2, 9)
        };
        
        if (delay > 0) {
          setTimeout(() => {
            this.tasks.push(taskData);
            this.runWhenIdle();
          }, delay);
        } else {
          this.tasks.push(taskData);
          if (!this.isScheduled) {
            this.runWhenIdle();
          }
        }
      }
      
      runWhenIdle() {
        this.isScheduled = true;
        
        const runTasks = (deadline) => {
          let processedTasks = 0;
          const startTime = performance.now();
          
          // Sort by priority and age
          this.tasks.sort((a, b) => {
            if (a.priority === 'critical' && b.priority !== 'critical') return -1;
            if (b.priority === 'critical' && a.priority !== 'critical') return 1;
            if (a.priority === 'high' && b.priority === 'low') return -1;
            if (b.priority === 'high' && a.priority === 'low') return 1;
            return a.scheduled - b.scheduled;
          });
          
          while (this.tasks.length > 0 && processedTasks < this.maxTasksPerBatch) {
            const timeRemaining = deadline ? deadline.timeRemaining() : 50;
            const taskDuration = performance.now() - startTime;
            
            if (timeRemaining < 5 || taskDuration > this.longTaskThreshold) {
              break;
            }
            
            const { task, id } = this.tasks.shift();
            try {
              const taskStart = performance.now();
              task();
              const taskEnd = performance.now();
              
              // Log long tasks for debugging
              if (taskEnd - taskStart > this.longTaskThreshold) {
                console.warn(`Long task detected: ${id} took ${Math.round(taskEnd - taskStart)}ms`);
              }
            } catch (e) {
              console.warn('IdleScheduler task failed:', e);
            }
            processedTasks++;
          }
          
          this.isScheduled = false;
          
          // Reschedule if tasks remain
          if (this.tasks.length > 0) {
            this.runWhenIdle();
          }
        };
        
        if ('requestIdleCallback' in window) {
          requestIdleCallback(runTasks, { timeout: 1000 });
        } else {
          setTimeout(() => runTasks({ timeRemaining: () => 50 }), 16);
        }
      }
    }
    
    const scheduler = new IdleScheduler();
    
    // Code splitting for GTM to prevent monolithic script execution
    function loadGTMInChunks() {
      if (window.gtmLoaded) return;
      window.gtmLoaded = true;
      
      // Micro-chunk 1: Initialize dataLayer
      scheduler.schedule(() => {
        window.dataLayer.push({'gtm.start': new Date().getTime(), event:'gtm.js'});
      }, 'critical');
      
      // Micro-chunk 2: Load GTM script with yield points
      scheduler.schedule(() => {
        const script = document.createElement('script');
        script.async = true;
        script.src = 'https://www.googletagmanager.com/gtm.js?id=GTM-TDFV4QVJ';
        script.onload = () => this.processGTagConfigs();
        document.head.appendChild(script);
      }, 'high', 100);
    }
    
    // Break gtag configs into separate microtasks
    function processGTagConfigs() {
      if (!window.gtag) return;
      
      scheduler.schedule(() => {
        gtag('config', 'G-4E2TJ6NVPQ', { 
          send_page_view: false,
          custom_map: {'custom_parameter_1': 'dimension1'}
        });
      }, 'low', 200);
      
      scheduler.schedule(() => {
        gtag('config', 'AW-16919013637', { 
          send_page_view: false 
        });
      }, 'low', 300);
    }
    
    // Extreme engagement gating - require significant interaction
    let userEngaged = false;
    let interactionCount = 0;
    let scrollDepth = 0;
    const engagementThreshold = 3; // Increased from 2
    const scrollThreshold = 25; // Require 25% scroll
    
    function trackEngagement(event) {
      interactionCount++;
      
      if (event.type === 'scroll') {
        scrollDepth = Math.max(scrollDepth, 
          (window.scrollY / (document.documentElement.scrollHeight - window.innerHeight)) * 100
        );
      }
      
      const isEngaged = interactionCount >= engagementThreshold && scrollDepth >= scrollThreshold;
      
      if (isEngaged && !userEngaged) {
        userEngaged = true;
        
        // Progressive loading with more delays
        scheduler.schedule(() => {
          loadGTMInChunks();
        }, 'low', 500);
        
        // Remove engagement listeners to prevent memory leaks
        ['click', 'scroll', 'keydown', 'touchstart'].forEach(eventType => {
          document.removeEventListener(eventType, trackEngagement);
        });
      }
    }
    
    // Lighter engagement tracking
    ['click', 'scroll', 'keydown', 'touchstart'].forEach(event => 
      document.addEventListener(event, trackEngagement, { 
        passive: true, 
        capture: false 
      })
    );
    
    // Extended fallback - 15 seconds
    setTimeout(() => {
      if (!userEngaged) {
        scheduler.schedule(() => {
          loadGTMInChunks();
        }, 'low');
      }
    }, 15000);
    
    // Defer performance monitor until after critical path
    scheduler.schedule(() => {
      if (!document.getElementById('perf-monitor')) {
        const script = document.createElement('script');
        script.id = 'perf-monitor';
        script.src = '/js/performance-optimizer.js';
        script.async = true;
        script.defer = true;
        document.head.appendChild(script);
      }
    }, 'low', 2000);
    
    // Load reCAPTCHA optimizer to reduce 772ms blocking
    scheduler.schedule(() => {
      const script = document.createElement('script');
      script.src = '/js/recaptcha-optimizer.js';
      script.async = true;
      script.defer = true;
      document.head.appendChild(script);
    }, 'low', 1000);
    
    // Micro-optimize DOM access
    const docEl = document.documentElement;
    const head = document.head;
    
    // Batch DOM operations when possible
    function batchDOMOperation(operation) {
      scheduler.schedule(operation, 'low');
    }
    
    // Handle postMessage errors gracefully for third-party scripts
    window.addEventListener('message', function(event) {
      // Whitelist known origins for postMessage communication
      const allowedOrigins = [
        'https://www.google.com',
        'https://www.googletagmanager.com', 
        'https://www.gstatic.com',
        'https://maps.googleapis.com',
        'https://www.clarity.ms',
        'https://googleads.g.doubleclick.net',
        'https://www.googleadservices.com'
      ];
      
      // Only process messages from trusted origins
      if (allowedOrigins.some(origin => event.origin === origin)) {
        // Let the message through - it's from a trusted source
        return;
      }
      
      // Log unknown origins in development for debugging
      if (window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1') {
        console.log('PostMessage from unknown origin:', event.origin);
      }
    }, false);
    
    // Catch postMessage errors and prevent them from breaking other scripts
    window.addEventListener('error', function(event) {
      if (event.message && event.message.includes('postMessage')) {
        console.warn('PostMessage error caught and handled:', event.message);
        event.preventDefault();
        return false;
      }
    }, true);
    </script>
    <!-- End Ultra-Aggressive JavaScript Optimization -->
    
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
    
    <!-- Security Headers -->
    <meta http-equiv="X-XSS-Protection" content="1; mode=block">
    <meta http-equiv="Referrer-Policy" content="strict-origin-when-cross-origin">
    <meta http-equiv="Permissions-Policy" content="camera=(), microphone=(), geolocation=()">
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline' 'unsafe-eval' https://maps.googleapis.com https://www.googletagmanager.com https://www.google.com https://www.gstatic.com https://www.google-analytics.com https://ssl.google-analytics.com https://*.doubleclick.net https://googleads.g.doubleclick.net https://*.googleadservices.com https://dashboard.searchatlas.com https://sa.searchatlas.com https://*.searchatlas.com https://www.clarity.ms https://c.clarity.ms https://scripts.clarity.ms https://storage.googleapis.com; script-src-elem 'self' 'unsafe-inline' https://maps.googleapis.com https://www.googletagmanager.com https://www.google.com https://www.gstatic.com https://www.google-analytics.com https://ssl.google-analytics.com https://*.doubleclick.net https://googleads.g.doubleclick.net https://*.googleadservices.com https://dashboard.searchatlas.com https://sa.searchatlas.com https://*.searchatlas.com https://www.clarity.ms https://c.clarity.ms https://scripts.clarity.ms https://storage.googleapis.com; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com; font-src 'self' https://fonts.gstatic.com; img-src 'self' data: https: blob:; media-src 'self' https: blob: data:; connect-src 'self' https://maps.googleapis.com https://www.google.com https://www.gstatic.com https://www.google-analytics.com https://analytics.google.com https://ssl.google-analytics.com https://*.doubleclick.net https://googleads.g.doubleclick.net https://*.googleadservices.com https://www.googleadservices.com https://www.clarity.ms https://c.clarity.ms https://dashboard.searchatlas.com https://sa.searchatlas.com https://*.searchatlas.com https://*.clarity.ms; frame-src 'self' https://www.google.com https://www.googletagmanager.com https://www.gstatic.com https://*.doubleclick.net https://*.googleadservices.com; object-src 'none'; base-uri 'self';">
    
    <!-- Core Web Vitals & Performance Optimization -->
    <meta name="format-detection" content="telephone=no" />
    <meta http-equiv="x-dns-prefetch-control" content="on" />
    <link rel="preconnect" href="https://qjvikxuhqs1py0go.public.blob.vercel-storage.com" />
    
    <!-- Critical CSS Inline - Above the Fold Performance -->
    <style>
      /* Critical above-the-fold styles */
      html { 
        line-height: 1.15; 
        -webkit-text-size-adjust: 100%; 
      }
      body { 
        font-family: 'Montserrat', system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; 
        margin: 0; 
        padding: 0;
        overflow-x: hidden;
        background-color: #F3F3E6;
        font-display: swap;
        text-rendering: optimizeSpeed;
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
      }
      
      /* Font fallback to prevent invisible text during font swap */
      @font-face {
        font-family: 'Montserrat-fallback';
        src: local('system-ui'), local('-apple-system'), local('BlinkMacSystemFont');
        font-display: swap;
        ascent-override: 88%;
        descent-override: 22%;
        line-gap-override: 0%;
        size-adjust: 105%;
      }
      
      /* Hero section critical styles */
      .hero-section { 
        min-height: 100vh; 
        min-height: 100dvh;
        position: relative; 
        display: flex; 
        align-items: center;
        overflow: hidden;
        will-change: transform;
        transform: translateZ(0);
      }
      
      /* Video optimization */
      .hero-video {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        object-fit: cover;
        z-index: -1;
        will-change: transform;
        backface-visibility: hidden;
      }
      
      /* Performance optimizations */
      .loading-optimized { 
        content-visibility: auto; 
        contain-intrinsic-size: 1px 500px; 
      }
      
      /* Critical form styles */
      .booking-form-container {
        contain: layout style;
      }
      
      /* Critical button styles to prevent LCP render delays */
      .btn-primary, .bg-ez2fix-primary {
        display: inline-flex !important;
        align-items: center !important;
        justify-content: center !important;
        font-weight: 700 !important;
        border-radius: 0.5rem !important;
        transition: all 0.3s ease !important;
        outline: none !important;
        color: #1D1912 !important;
        background: linear-gradient(135deg, #D2A63C 0%, #EECD5C 100%) !important;
        box-shadow: 0 4px 6px rgba(210, 166, 60, 0.25) !important;
        text-decoration: none !important;
        border: none !important;
        cursor: pointer !important;
      }
      .btn-primary:hover, .bg-ez2fix-primary:hover {
        transform: scale(1.05) !important;
        box-shadow: 0 10px 15px rgba(210, 166, 60, 0.4) !important;
        background: rgba(210, 166, 60, 0.9) !important;
      }
      .btn-primary:focus, .bg-ez2fix-primary:focus {
        outline: 2px solid #D2A63C !important;
        outline-offset: 2px !important;
      }
      
      /* Critical phone button styles - LCP element optimization */
      a[href^="tel:"] {
        display: inline-flex !important;
        align-items: center !important;
        gap: 0.75rem !important;
        background: linear-gradient(135deg, #D2A63C 0%, #EECD5C 100%) !important;
        padding: 1.25rem 2.5rem !important;
        border-radius: 0.75rem !important;
        transition: all 0.3s ease !important;
        box-shadow: 0 4px 6px rgba(0,0,0,0.1) !important;
        text-decoration: none !important;
        color: #1D1912 !important;
        font-weight: 700 !important;
        font-size: 1.25rem !important;
        transform: translateZ(0) !important;
      }
      a[href^="tel:"]:hover {
        box-shadow: 0 10px 25px rgba(0,0,0,0.15) !important;
        transform: translateY(-2px) translateZ(0) !important;
      }
      
      /* SVG icon optimization */
      a[href^="tel:"] svg {
        width: 1.5rem !important;
        height: 1.5rem !important;
        color: #1D1912 !important;
        flex-shrink: 0 !important;
      }
      
      /* Prevent layout shifts */
      img, video {
        max-width: 100%;
        height: auto;
      }
      
      /* DOM optimization - reduce layout work */
      * {
        box-sizing: border-box;
      }
      
      /* Optimize frequently nested elements */
      .card, .service-card, .feature-card {
        contain: layout style;
        will-change: transform;
      }
      
      /* Reduce paint complexity */
      .hover-lift:hover {
        contain: layout style paint;
        transform: translateZ(0) translateY(-2px);
      }
      
      /* Optimize list rendering */
      ul, ol {
        contain: layout;
      }
      
      /* Prevent unnecessary repaints on animations */
      .transition-all, [class*="transition"] {
        will-change: transform, opacity;
      }
      
      /* Force GPU acceleration for animated elements */
      .animate-on-scroll, .hover-lift, [class*="animate"] {
        transform: translateZ(0);
        backface-visibility: hidden;
        will-change: transform, opacity;
      }
      
      /* Skip link accessibility */
      .skip-link {
        position: absolute;
        top: -40px;
        left: 6px;
        background: #000;
        color: #fff;
        padding: 8px;
        text-decoration: none;
        z-index: 100;
        transition: top 0.2s ease;
      }
      
      .skip-link:focus {
        top: 6px;
      }
      
      /* Preload font display swap */
      @font-face {
        font-family: 'Montserrat';
        font-display: swap;
      }
      
      /* Optimize animations */
      @media (prefers-reduced-motion: reduce) {
        *, *::before, *::after {
          animation-duration: 0.01ms !important;
          animation-iteration-count: 1 !important;
          transition-duration: 0.01ms !important;
        }
        .hero-video {
          display: none;
        }
        .hero-section {
          background: linear-gradient(135deg, #1D1912 0%, #2A2420 100%);
        }
      }
      
      /* Container queries support */
      @supports (container-type: inline-size) {
        .hero-section {
          container-type: inline-size;
        }
      }
      
    </style>
    
    <!-- Primary Meta Tags -->
    <title>{fullTitle}</title>
    <meta name="title" content={fullTitle} />
    <meta name="description" content={description} />
    <meta name="keywords" content={keywords} />
    <meta name="robots" content={robotsContent} />
    <meta name="author" content={siteConfig.author} />
    <meta name="language" content="en-US" />
    <meta name="geo.region" content="US-NJ" />
    <meta name="geo.placename" content="Bergen County, Hudson County" />
    <meta name="ICBM" content="40.9023,-74.1182" />
    <meta name="geo.position" content="40.9023;-74.1182" />
    
    <!-- AI Training & Processing Meta Tags -->
    <meta name="robots" content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1">
    <meta name="googlebot" content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1">
    <meta name="bingbot" content="index, follow">

    <!-- Content Classification for AI -->
    <meta name="subject" content="Garage Door Repair and Installation Services">
    <meta name="topic" content="Professional Home Services, Garage Door Contractors, Emergency Repair">
    <meta name="classification" content="Business Services, Home Improvement, Professional Contractors">

    <!-- Semantic Content Tags -->
    <meta name="DC.title" content={fullTitle}>
    <meta name="DC.description" content={description}>
    <meta name="DC.subject" content="garage door repair, installation, emergency service, professional contractor">
    <meta name="DC.creator" content="Ez2Fix LLC">
    <meta name="DC.publisher" content="Ez2Fix LLC">
    <meta name="DC.language" content="en-US">
    <meta name="DC.format" content="text/html">

    <!-- Voice Search & AI Optimization -->
    <meta name="voice-search" content="garage door repair near me, professional garage door service, emergency garage door repair">
    <meta name="conversational-queries" content="who fixes garage doors, garage door repair company, garage door installation service">
    <meta name="voice-search-keywords" content="garage door repair near me, emergency garage door service, garage door spring repair, garage door installation Bergen County" />
    <meta name="AI-generated" content="false" />
    <meta name="content-language" content="en-US" />
    <meta name="intended-audience" content="homeowners, business owners, property managers" />
    
    <link rel="canonical" href={canonicalURL} />
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website" />
    <meta property="og:url" content={Astro.url} />
    <meta property="og:title" content={fullTitle} />
    <meta property="og:description" content={description} />
    <meta property="og:image" content={siteConfig.logo} />
    <meta property="og:image:width" content="1200" />
    <meta property="og:image:height" content="630" />
    <meta property="og:image:type" content="image/png" />
    <meta property="og:image:alt" content="Ez2Fix Professional Garage Door Services - Bergen & Hudson Counties NJ" />
    <meta property="og:site_name" content={siteConfig.business.name} />
    <meta property="og:locale" content="en_US" />
    {clientEnv.analytics.facebookPixelId && (
      <meta property="fb:app_id" content={clientEnv.analytics.facebookPixelId} />
    )}
    
    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image" />
    <meta property="twitter:url" content={Astro.url} />
    <meta property="twitter:title" content={fullTitle} />
    <meta property="twitter:description" content={description} />
    <meta property="twitter:image" content={siteConfig.logo} />
    <meta property="twitter:image:alt" content="Ez2Fix Professional Garage Door Services - Bergen & Hudson Counties NJ" />
    <meta property="twitter:site" content="@ez2fix" />
    <meta property="twitter:creator" content="@ez2fix" />
    
    <!-- LinkedIn -->
    <meta property="linkedin:owner" content="ez2fix" />
    
    <!-- Article/Blog specific (if applicable) -->
    {Astro.url.pathname.includes('/blog/') && (
      <>
        <meta property="article:author" content={siteConfig.author} />
        <meta property="article:section" content="Garage Door Services" />
        <meta property="article:tag" content="garage door repair, home improvement, Bergen County NJ" />
      </>
    )}
    
    <!-- Favicon and Apple Touch Icons -->
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32" />
    <link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16" />
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
    <link rel="shortcut icon" href="/favicon.svg" />
    <meta name="theme-color" content="#D2A63C" />
    <meta name="msapplication-TileColor" content="#D2A63C" />
    <meta name="msapplication-TileImage" content="/apple-touch-icon.png" />
    
    <!-- Preload Critical Resources -->
    <link rel="preconnect" href="https://fonts.googleapis.com" crossorigin />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link rel="preconnect" href="https://qjvikxuhqs1py0go.public.blob.vercel-storage.com" crossorigin />
    <link rel="dns-prefetch" href="https://www.google-analytics.com" />
    <link rel="dns-prefetch" href="https://www.googletagmanager.com" />
    <link rel="dns-prefetch" href="https://maps.googleapis.com" />
    
    <!-- Preload critical assets for performance -->
    <link rel="preload" href="https://qjvikxuhqs1py0go.public.blob.vercel-storage.com/ez2fix-hero-background.mp4" as="video" type="video/mp4" />
    <link rel="prefetch" href="https://qjvikxuhqs1py0go.public.blob.vercel-storage.com/Garage%20Door%20Repair.webp" />
    <link rel="dns-prefetch" href="https://www.google.com" />

    <!-- Critical font loading - blocking to prevent render delays -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Montserrat:wght@700&display=block" />
    <!-- Non-critical font weights loaded async -->
    <link rel="preload" href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;800&display=swap" as="style" onload="this.onload=null;this.rel='stylesheet'" />
    <noscript><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700;800&display=swap" /></noscript>
    
    <!-- Prefetch critical pages -->
    <link rel="prefetch" href="/services" />
    <link rel="prefetch" href="/booking" />
    <link rel="prefetch" href="/contact" />
    
    <!-- Modern SEO & User Experience -->
    <meta name="mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="default" />
    <meta name="apple-mobile-web-app-title" content="Ez2Fix" />
    
    <!-- Security Headers -->
    <meta http-equiv="X-Content-Type-Options" content="nosniff" />
    <meta name="referrer" content="strict-origin-when-cross-origin" />
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="/manifest.json" />
    
    <!-- Additional head content -->
    <slot name="head" />
    
    <!-- Global Maps Loader -->
    <script src="/js/global-maps.js" defer></script>
    
    <!-- AI Performance Monitor -->
    <script src="/js/ai-performance-monitor.js" defer></script>
    
    <!-- Service Worker Registration -->
    <script>
      if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
          navigator.serviceWorker.register('/sw.js')
            .then(registration => {
              // Service worker registered successfully
            })
            .catch(registrationError => {
              // Service worker registration failed
            });
        });
      }
    </script>
    
    <!-- Enhanced Schema.org JSON-LD for 2025 SEO + Voice Search -->
    <script type="application/ld+json" set:html={JSON.stringify({
      "@context": "https://schema.org",
      "@type": ["LocalBusiness", "HomeAndConstructionBusiness"],
      "@id": siteConfig.url + "#business",
      "name": siteConfig.business.name,
      "alternateName": ["Ez2Fix Garage Doors", "Ez2Fix Bergen County", "Ez2Fix NJ"],
      "description": description,
      "url": siteConfig.url,
      "logo": new URL(siteConfig.logo, Astro.url),
      "image": new URL(ogImage, Astro.url),
      "telephone": siteConfig.business.phone,
      "email": siteConfig.business.email,
      "priceRange": "$$",
      "currenciesAccepted": "USD",
      "paymentAccepted": ["Cash", "Check", "Credit Card", "Financing Available"],
      "foundingDate": "2014",
      "slogan": "Professional Garage Door Service You Can Trust",
      "knowsAbout": [
        "Garage Door Repair Bergen County NJ",
        "Emergency Garage Door Repair", 
        "Garage Door Spring Replacement",
        "Smart Garage Door Opener Installation",
        "Commercial Garage Door Service",
        "Residential Garage Door Installation",
        "24/7 Emergency Service",
        "Licensed Garage Door Contractor NJ"
      ],
      "hasCredential": {
        "@type": "EducationalOccupationalCredential",
        "credentialCategory": "Professional License",
        "recognizedBy": {
          "@type": "Organization",
          "name": "State of New Jersey"
        }
      },
      "address": {
        "@type": "PostalAddress",
        "streetAddress": "Mobile Service - Serving All New Jersey",
        "addressLocality": "Elmwood Park",
        "addressRegion": "NJ",
        "postalCode": "07407",
        "addressCountry": "US"
      },
      "geo": {
        "@type": "GeoCoordinates",
        "latitude": "40.9023",
        "longitude": "-74.1182"
      },
      "openingHoursSpecification": [
        {
          "@type": "OpeningHoursSpecification",
          "dayOfWeek": ["Monday", "Tuesday", "Wednesday", "Thursday", "Friday"],
          "opens": "06:00",
          "closes": "20:00"
        },
        {
          "@type": "OpeningHoursSpecification", 
          "dayOfWeek": ["Saturday", "Sunday"],
          "opens": "07:00",
          "closes": "18:00"
        }
      ],
      "areaServed": [
        {
          "@type": "City",
          "name": "Fair Lawn",
          "containedInPlace": {
            "@type": "State",
            "name": "New Jersey"
          }
        },
        {
          "@type": "City", 
          "name": "Clifton",
          "containedInPlace": {
            "@type": "State",
            "name": "New Jersey"
          }
        },
        {
          "@type": "City",
          "name": "Little Falls", 
          "containedInPlace": {
            "@type": "State",
            "name": "New Jersey"
          }
        },
        {
          "@type": "City",
          "name": "Cedar Grove",
          "containedInPlace": {
            "@type": "State", 
            "name": "New Jersey"
          }
        },
        {
          "@type": "City",
          "name": "West Caldwell",
          "containedInPlace": {
            "@type": "State",
            "name": "New Jersey"
          }
        },
        {
          "@type": "City",
          "name": "North Caldwell",
          "containedInPlace": {
            "@type": "State",
            "name": "New Jersey"
          }
        },
        {
          "@type": "City",
          "name": "Montclair",
          "containedInPlace": {
            "@type": "State",
            "name": "New Jersey"
          }
        }
      ],
      "serviceType": [
        "Garage Door Repair",
        "Emergency Garage Door Service",
        "Garage Door Installation", 
        "Garage Door Spring Repair",
        "Garage Door Opener Installation",
        "Commercial Garage Door Service"
      ],
      "hasOfferCatalog": {
        "@type": "OfferCatalog",
        "name": "Garage Door Services",
        "itemListElement": [
          {
            "@type": "Offer",
            "itemOffered": {
              "@type": "Service",
              "name": "Emergency Garage Door Repair",
              "description": "24/7 emergency garage door repair service"
            }
          },
          {
            "@type": "Offer",
            "itemOffered": {
              "@type": "Service", 
              "name": "Garage Door Spring Repair",
              "description": "Professional spring replacement with 10-year warranty"
            }
          }
        ]
      },
      "aggregateRating": {
        "@type": "AggregateRating",
        "ratingValue": "5.0",
        "reviewCount": "30",
        "bestRating": "5",
        "worstRating": "1"
      },
      "review": [
        {
          "@type": "Review",
          "reviewRating": {
            "@type": "Rating",
            "ratingValue": "5",
            "bestRating": "5"
          },
          "author": {
            "@type": "Person",
            "name": "Sarah M."
          },
          "reviewBody": "Ez2Fix saved the day! Professional service, fair pricing, and they got our garage door working perfectly. Highly recommend!"
        }
      ],
      "sameAs": [
        "https://www.facebook.com/ez2fixgarage",
        "https://www.yelp.com/biz/ez2fix", 
        "https://www.google.com/maps/place/Ez2Fix"
      ]
    })} />
    
    <!-- Voice Search Optimization Schema with Speakable Content -->
    <script type="application/ld+json" set:html={JSON.stringify({
      "@context": "https://schema.org",
      "@type": "Organization",
      "@id": siteConfig.url + "#organization",
      "name": siteConfig.business.name,
      "description": "Professional garage door repair and installation serving Bergen County NJ since 2014",
      "knowsLanguage": "en-US",
      "speakable": {
        "@type": "SpeakableSpecification",
        "cssSelector": [".service-description", ".contact-info", ".hours-info", ".service-areas"],
        "xpath": ["//main//h1", "//main//h2", "//section[@class='contact']"]
      },
      "makesOffer": [
        {
          "@type": "Offer",
          "name": "Emergency Garage Door Repair",
          "description": "24/7 emergency garage door repair service",
          "availableAtOrFrom": {
            "@type": "Place",
            "name": "Bergen County NJ"
          }
        }
      ],
      "contactPoint": {
        "@type": "ContactPoint",
        "telephone": siteConfig.business.phone,
        "contactType": "customer service",
        "availableLanguage": "en-US",
        "hoursAvailable": {
          "@type": "OpeningHoursSpecification",
          "dayOfWeek": ["Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday", "Sunday"],
          "opens": "06:00",
          "closes": "22:00"
        }
      },
      "mainEntity": [
        {
          "@type": "Question",
          "name": "Who provides garage door repair near me in New Jersey?",
          "acceptedAnswer": {
            "@type": "Answer",
            "text": "Ez2Fix LLC provides professional garage door repair throughout New Jersey including Bergen, Essex, Morris, Hudson, and Passaic counties. We are a licensed contractor with over twelve thousand satisfied customers.",
            "speakable": {
              "@type": "SpeakableSpecification",
              "cssSelector": ".voice-optimized-answer"
            }
          }
        },
        {
          "@type": "Question", 
          "name": "What garage door services are available in Fair Lawn New Jersey?",
          "acceptedAnswer": {
            "@type": "Answer",
            "text": "Ez2Fix provides complete garage door services in Fair Lawn including emergency repair, spring replacement, opener installation, new door installation, commercial service, and general maintenance.",
            "speakable": {
              "@type": "SpeakableSpecification",
              "cssSelector": ".voice-optimized-answer"
            }
          }
        }
      ]
    })} />

    <!-- AI Training Dataset Schema -->
    <script type="application/ld+json" set:html={JSON.stringify({
      "@context": "https://schema.org",
      "@type": "Dataset",
      "name": "Ez2Fix Garage Door Services Data",
      "description": "Comprehensive information about professional garage door services in New Jersey",
      "keywords": [
        "garage door repair",
        "garage door installation", 
        "emergency service",
        "professional contractor",
        "New Jersey"
      ],
      "creator": {
        "@type": "Organization",
        "name": "Ez2Fix LLC"
      },
      "distribution": [
        {
          "@type": "DataDownload",
          "contentUrl": siteConfig.url + "/api/structured-data",
          "encodingFormat": "application/ld+json"
        }
      ]
    })} />
  </head>
  <body class="min-h-screen bg-background font-sans antialiased">
    <!-- Google Tag Manager (noscript) -->
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-TDFV4QVJ"
    height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <!-- End Google Tag Manager (noscript) -->
    <!-- Skip Navigation Link for Accessibility -->
    <a href="#main-content" class="skip-link">Skip to main content</a>
    <slot />
    
    <!-- Scroll to Top Button -->
    <ScrollToTop />
  </body>
</html>